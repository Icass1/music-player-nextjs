#!/bin/bash

set -e

# Set HOST variable on the local machine
HOST=$(hostname)

# Use SSH to execute commands on the remote machine
# ssh icass@12.12.12.3 '
# HOST="'$HOST'"
# cd /home/icass/HomeDrive/root/Programming/music-player-nextjs
# echo "Removing node_modules"
# rm -rf /home/icass/HomeDrive/root/Programming/music-player-nextjs/node_modules
# echo "Done"
# if test -d $HOST.node_modules; then
#     echo $HOST.node_modules found. Coping it to node_modules
#     cp -r /home/icass/HomeDrive/root/Programming/music-player-nextjs/$HOST.node_modules /home/icass/HomeDrive/root/Programming/music-player-nextjs/node_modules
#     echo "Done"
# else
#     echo $HOST.node_modules not found. Running npm install
#     npm install
#     echo Done
#     echo Coping node_modules to $HOST.node_modules
#     cp -r /home/icass/HomeDrive/root/Programming/music-player-nextjs/node_modules /home/icass/HomeDrive/root/Programming/music-player-nextjs/$HOST.node_modules
#     echo Done
# fi
# '

if test -d $HOST.node_modules; then
    ssh icass@12.12.12.3 '
    HOST="'$HOST'"
    cd /home/icass/HomeDrive/root/Programming/music-player-nextjs
    echo Removing node_modules...
    rm -rf node_modules
    echo Done
    echo $HOST.node_modules found. Coping it to node_modules...
    cp -r $HOST.node_modules node_modules
    echo "Done"
    '
else
    ssh icass@12.12.12.3 '
    cd /home/icass/HomeDrive/root/Programming/music-player-nextjs
    echo Removing node_modules...
    rm -rf node_modules
    echo Done
    '
    echo $HOST.node_modules not found. Running npm install...
    npm install
    echo Done

    ssh icass@12.12.12.3 '
    HOST="'$HOST'"
    cd /home/icass/HomeDrive/root/Programming/music-player-nextjs
    echo Coping node_modules to $HOST.node_modules
    cp -r /home/icass/HomeDrive/root/Programming/music-player-nextjs/node_modules /home/icass/HomeDrive/root/Programming/music-player-nextjs/$HOST.node_modules
    echo Done
    '

fi

